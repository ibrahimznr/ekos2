{
  "timestamp": "2025-12-30T06:03:49.779829",
  "test_focus": "EKOS Review Request - P0 Bug Fix & P1 Features",
  "total_tests": 74,
  "passed_tests": 69,
  "failed_tests": 5,
  "success_rate": 93.24324324324324,
  "critical_failures": [
    "ZIP Export - Unauthorized Access: Status: 403, Error: {'detail': 'Not authenticated'}"
  ],
  "test_results": [
    {
      "test": "Login with ibrahimznrmak@gmail.com",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['access_token', 'token_type', 'user']",
      "critical": true
    },
    {
      "test": "User Role Check",
      "status": "PASS",
      "details": "User role: admin",
      "critical": false
    },
    {
      "test": "Dashboard Stats with İskele Data",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['total_raporlar', 'monthly_raporlar', 'uygun_count', 'uygun_degil_count', 'expiring_30_days', 'expiring_7_days', 'kategori_dagilim', 'iskele_stats']",
      "critical": true
    },
    {
      "test": "İskele Total Count",
      "status": "PASS",
      "details": "Total: 9983 (expected > 0)",
      "critical": false
    },
    {
      "test": "İskele Uygun Count",
      "status": "PASS",
      "details": "Uygun: 9646 (expected > 0)",
      "critical": false
    },
    {
      "test": "İskele Uygun Değil Count (CRITICAL FIX)",
      "status": "PASS",
      "details": "Uygun Değil: 337 (expected: 337, was 0 before fix)",
      "critical": true
    },
    {
      "test": "İskele Uygunluk Oranı Calculation",
      "status": "PASS",
      "details": "Calculated: 96.6%, Expected: 96.6%",
      "critical": false
    },
    {
      "test": "Get İskele Bileşenleri Data",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "İskele Data Consistency Check",
      "status": "PASS",
      "details": "Dashboard shows 337, Direct count: 337",
      "critical": false
    },
    {
      "test": "İskele Bileşenleri Count",
      "status": "PASS",
      "details": "Found 168 iskele bileşeni records",
      "critical": false
    },
    {
      "test": "Get Files for Test Report",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "PDF File Found",
      "status": "PASS",
      "details": "Found PDF: test_rapor.pdf (ID: 509cfa24-4ed4-4d58-8981-b4ad83758bad)",
      "critical": false
    },
    {
      "test": "PDF Download Response 200 OK",
      "status": "PASS",
      "details": "Status: 200",
      "critical": true
    },
    {
      "test": "PDF Content-Type Header",
      "status": "PASS",
      "details": "Content-Type: application/pdf",
      "critical": true
    },
    {
      "test": "PDF File Format Validation",
      "status": "PASS",
      "details": "File starts with: b'%PDF-1.4\\n1' (should start with %PDF)",
      "critical": true
    },
    {
      "test": "PDF File Size",
      "status": "PASS",
      "details": "File size: 597 bytes",
      "critical": false
    },
    {
      "test": "GET /api/raporlar",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "GET /api/kategoriler",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "GET /api/projeler",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "GET /api/dashboard/stats",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['total_raporlar', 'monthly_raporlar', 'uygun_count', 'uygun_degil_count', 'expiring_30_days', 'expiring_7_days', 'kategori_dagilim', 'iskele_stats']",
      "critical": true
    },
    {
      "test": "Get Projects for Report",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "Get Categories for Report",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "Create New Report (Two-Stage Modal Test)",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['id', 'rapor_no', 'proje_id', 'proje_adi', 'sehir', 'sehir_kodu', 'ekipman_adi', 'kategori', 'alt_kategori', 'firma', 'lokasyon', 'marka_model', 'seri_no', 'periyot', 'gecerlilik_tarihi', 'aciklama', 'uygunluk', 'durum', 'created_by', 'created_by_username', 'created_at', 'updated_at']",
      "critical": true
    },
    {
      "test": "Report Number Format",
      "status": "PASS",
      "details": "Generated report number: PK2025-IST001",
      "critical": false
    },
    {
      "test": "Get Created Report",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['id', 'rapor_no', 'proje_id', 'proje_adi', 'sehir', 'sehir_kodu', 'ekipman_adi', 'kategori', 'alt_kategori', 'firma', 'lokasyon', 'marka_model', 'seri_no', 'periyot', 'gecerlilik_tarihi', 'aciklama', 'uygunluk', 'durum', 'created_by', 'created_by_username', 'created_at', 'updated_at']",
      "critical": true
    },
    {
      "test": "Update Report (Second Stage)",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['id', 'rapor_no', 'proje_id', 'proje_adi', 'sehir', 'sehir_kodu', 'ekipman_adi', 'kategori', 'alt_kategori', 'firma', 'lokasyon', 'marka_model', 'seri_no', 'periyot', 'gecerlilik_tarihi', 'aciklama', 'uygunluk', 'durum', 'created_by', 'created_by_username', 'created_at', 'updated_at']",
      "critical": true
    },
    {
      "test": "Cleanup Test Report",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['message']",
      "critical": false
    },
    {
      "test": "Get Category-Subcategory Map",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['Basınçlı Kaplar', 'Asansör', 'Kaldırma Platformu', 'Vinç', 'Forklift', 'İskele']",
      "critical": true
    },
    {
      "test": "Category Map Structure",
      "status": "PASS",
      "details": "Found 6 category mappings",
      "critical": false
    },
    {
      "test": "Category 'Forklift' Subcategories",
      "status": "PASS",
      "details": "Has 4 subcategories",
      "critical": false
    },
    {
      "test": "Category 'Asansör' Subcategories",
      "status": "PASS",
      "details": "Has 4 subcategories",
      "critical": false
    },
    {
      "test": "Category 'Kaldırma-İletme' Missing",
      "status": "FAIL",
      "details": "Category not found in mapping",
      "critical": false
    },
    {
      "test": "Get Cities",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "Cities Count",
      "status": "PASS",
      "details": "Found 81 cities",
      "critical": false
    },
    {
      "test": "City 'İstanbul' Available",
      "status": "PASS",
      "details": "City found",
      "critical": false
    },
    {
      "test": "City 'Ankara' Available",
      "status": "PASS",
      "details": "City found",
      "critical": false
    },
    {
      "test": "City 'İzmir' Available",
      "status": "PASS",
      "details": "City found",
      "critical": false
    },
    {
      "test": "City 'Adana' Available",
      "status": "PASS",
      "details": "City found",
      "critical": false
    },
    {
      "test": "Dashboard Stats",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['total_raporlar', 'monthly_raporlar', 'uygun_count', 'uygun_degil_count', 'expiring_30_days', 'expiring_7_days', 'kategori_dagilim', 'iskele_stats']",
      "critical": true
    },
    {
      "test": "Dashboard Field 'total_raporlar'",
      "status": "PASS",
      "details": "Value: 1149",
      "critical": false
    },
    {
      "test": "Dashboard Field 'monthly_raporlar'",
      "status": "PASS",
      "details": "Value: 313",
      "critical": false
    },
    {
      "test": "Dashboard Field 'uygun_count'",
      "status": "PASS",
      "details": "Value: 1054",
      "critical": false
    },
    {
      "test": "Dashboard Field 'uygun_degil_count'",
      "status": "PASS",
      "details": "Value: 79",
      "critical": false
    },
    {
      "test": "Dashboard Field 'expiring_30_days'",
      "status": "PASS",
      "details": "Value: 57",
      "critical": false
    },
    {
      "test": "Dashboard Field 'expiring_7_days'",
      "status": "PASS",
      "details": "Value: 17",
      "critical": false
    },
    {
      "test": "Dashboard Field 'kategori_dagilim'",
      "status": "PASS",
      "details": "Value: [{'count': 324, 'kategori': 'Kaldırma-İletme'}, {'count': 242, 'kategori': 'İskele (Sıva)'}, {'count': 198, 'kategori': 'Endüstriyel Raflar ve Kapılar'}, {'count': 118, 'kategori': 'Tezgah'}, {'count': 114, 'kategori': 'İş Makinesi'}, {'count': 30, 'kategori': 'Depolama Raf'}]",
      "critical": false
    },
    {
      "test": "Get Reports for ZIP Export",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": true
    },
    {
      "test": "ZIP Export - 3 Reports Success",
      "status": "PASS",
      "details": "Status: 200",
      "critical": true
    },
    {
      "test": "ZIP Content Type",
      "status": "PASS",
      "details": "Response received for ZIP export",
      "critical": false
    },
    {
      "test": "ZIP Export - Empty IDs Error",
      "status": "PASS",
      "details": "Status: 400, Response keys: ['detail']",
      "critical": true
    },
    {
      "test": "Empty IDs Error Message",
      "status": "PASS",
      "details": "Correctly rejected empty rapor_ids",
      "critical": false
    },
    {
      "test": "ZIP Export - 100+ Reports Limit",
      "status": "PASS",
      "details": "Status: 400, Response keys: ['detail']",
      "critical": true
    },
    {
      "test": "100+ Reports Limit Error",
      "status": "PASS",
      "details": "Correctly rejected 100+ reports",
      "critical": false
    },
    {
      "test": "ZIP Export - Unauthorized Access",
      "status": "FAIL",
      "details": "Status: 403, Error: {'detail': 'Not authenticated'}",
      "critical": true
    },
    {
      "test": "ZIP Export - Invalid Report IDs",
      "status": "PASS",
      "details": "Status: 404, Response keys: ['detail']",
      "critical": false
    },
    {
      "test": "Invalid IDs Handling",
      "status": "PASS",
      "details": "Correctly handled invalid report IDs",
      "critical": false
    },
    {
      "test": "Get Current User",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['id', 'username', 'email', 'role', 'firma_adi', 'email_verified', 'created_at']",
      "critical": false
    },
    {
      "test": "Invalid Login",
      "status": "PASS",
      "details": "Status: 401, Response keys: ['detail']",
      "critical": false
    },
    {
      "test": "Get Categories",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": false
    },
    {
      "test": "Categories Count",
      "status": "PASS",
      "details": "Found 58 categories",
      "critical": false
    },
    {
      "test": "Create Category",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['id', 'isim', 'alt_kategoriler', 'aciklama', 'created_at']",
      "critical": false
    },
    {
      "test": "Delete Category",
      "status": "PASS",
      "details": "Status: 200, Response keys: ['message']",
      "critical": false
    },
    {
      "test": "Get Reports",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": false
    },
    {
      "test": "Reports Count",
      "status": "PASS",
      "details": "Found 500 reports",
      "critical": false
    },
    {
      "test": "Search Reports",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": false
    },
    {
      "test": "Filter by Category",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": false
    },
    {
      "test": "Filter by Uygunluk",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": false
    },
    {
      "test": "Create Report",
      "status": "FAIL",
      "details": "Status: 422, Error: {'detail': [{'type': 'missing', 'loc': ['body', 'proje_id'], 'msg': 'Field required', 'input': {'ekipman_adi': 'Test Ekipman 060349', 'kategori': 'Asansör', 'firma': 'Test Firma', 'lokasyon': 'Test Lokasyon', 'marka_model': 'Test Model', 'seri_no': 'TEST123', 'alt_kategori': 'Test Alt Kategori', 'periyot': '6 Aylık', 'gecerlilik_tarihi': '2025-12-31', 'uygunluk': 'Uygun', 'aciklama': 'Test raporu'}, 'url': 'https://errors.pydantic.dev/2.12/v/missing'}, {'type': 'missing', 'loc': ['body', 'sehir'], 'msg': 'Field required', 'input': {'ekipman_adi': 'Test Ekipman 060349', 'kategori': 'Asansör', 'firma': 'Test Firma', 'lokasyon': 'Test Lokasyon', 'marka_model': 'Test Model', 'seri_no': 'TEST123', 'alt_kategori': 'Test Alt Kategori', 'periyot': '6 Aylık', 'gecerlilik_tarihi': '2025-12-31', 'uygunluk': 'Uygun', 'aciklama': 'Test raporu'}, 'url': 'https://errors.pydantic.dev/2.12/v/missing'}]}",
      "critical": false
    },
    {
      "test": "Excel Export",
      "status": "PASS",
      "details": "Status: 200",
      "critical": false
    },
    {
      "test": "Excel Template",
      "status": "PASS",
      "details": "Status: 200",
      "critical": false
    },
    {
      "test": "Excel Import",
      "status": "FAIL",
      "details": "Status: 422, Error: {'detail': [{'type': 'missing', 'loc': ['body', 'proje_id'], 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.12/v/missing'}]}",
      "critical": false
    },
    {
      "test": "Get Users",
      "status": "PASS",
      "details": "Status: 200, Response keys: Array",
      "critical": false
    },
    {
      "test": "Users Count",
      "status": "PASS",
      "details": "Found 5 users",
      "critical": false
    },
    {
      "test": "Create User",
      "status": "FAIL",
      "details": "Status: 422, Error: {'detail': [{'type': 'missing', 'loc': ['body', 'username'], 'msg': 'Field required', 'input': {'email': 'test060349@test.com', 'password': 'testpass123', 'role': 'viewer'}, 'url': 'https://errors.pydantic.dev/2.12/v/missing'}, {'type': 'missing', 'loc': ['body', 'password_confirm'], 'msg': 'Field required', 'input': {'email': 'test060349@test.com', 'password': 'testpass123', 'role': 'viewer'}, 'url': 'https://errors.pydantic.dev/2.12/v/missing'}, {'type': 'missing', 'loc': ['body', 'firma_adi'], 'msg': 'Field required', 'input': {'email': 'test060349@test.com', 'password': 'testpass123', 'role': 'viewer'}, 'url': 'https://errors.pydantic.dev/2.12/v/missing'}]}",
      "critical": false
    }
  ]
}